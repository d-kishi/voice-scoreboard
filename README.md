# Voice Scoreboard

音声操作に対応したスポーツ競技用スコアボードアプリ

## 概要

バレーボールをはじめとするスポーツ競技の得点管理を、音声入力と音声読み上げで直感的に操作できるモバイルアプリケーションです。

**主な利用シーン：** 普段の練習時に得点板の代わりとして使用

※ 公式戦での使用は想定していません

## プロジェクト情報

| 項目 | 内容 |
|------|------|
| 開発形態 | 個人開発 |
| リポジトリ | Public（オープンソース） |
| ライセンス | MIT License |

## 要件定義

### 対象ユーザー

- 部活動・サークルの練習参加者
- 練習試合や草試合の運営者
- 得点板がない環境での練習

### 対応競技（初期リリース）

- **6人制バレーボール**
  - 25点マッチ（1セット）
  - デュース対応（24-24以降は2点差がつくまで継続）

### 将来対応予定

- 9人制バレーボール
- バスケットボール
- 卓球
- バドミントン
- その他スポーツ競技

---

## 機能要件

### 初期リリース（v1.0）

#### 得点管理機能

- [ ] チームA/チームBの得点表示
- [ ] 得点の加算（+1点）
- [ ] 得点の減算（-1点 / 誤操作修正用）
- [ ] ロールバック（直前の1操作のみ取り消し可能）
- [ ] 得点リセット
  - タップ操作: 確認ダイアログを表示
  - 音声コマンド: 確認なしで即実行
- [ ] 試合終了判定（25点先取、24-24以降は2点差）
  - 終了後はスコア固定表示
  - 手動リセット（ボタンまたは音声）で次の試合へ
  - 終了後の得点操作は受け付けない

#### 音声入力機能

- [ ] 日本語音声認識（ja-JP）
  - iOS: Siri音声認識エンジン
  - Android: Google音声認識エンジン
- [ ] 双方向音声インターフェース（K.I.T.T.スタイル）
  - ウェイクワード「スコア」検知 → システムが「Ready」と応答
  - 認識モード開始（3秒間有効、タイムアウトで自動終了）
  - コマンド検知 → システムが「Roger」と応答 → 操作実行
- [ ] 音声コマンドによる得点操作
  - 「スコア」→「Ready」→「右」→「Roger」: 画面右側のチームに+1点
  - 「スコア」→「Ready」→「左」→「Roger」: 画面左側のチームに+1点
  - 「スコア」→「Ready」→「ロールバック」→「Roger」: 直前の操作を取り消し
  - 「スコア」→「Ready」→「リセット」→「Roger」: 0-0の状態に戻す
- [ ] 音声認識のオン/オフ切り替え

#### 音声読み上げ機能

- [ ] システム応答音声
  - 「Ready」: ウェイクワード認識時
  - 「Roger」: コマンド認識時
- [ ] スコア読み上げ（ロールバック/リセット実行後のみ）
  - 例：「左15 右12」
  - 得点加算/減算時は読み上げしない（Rogerのみ）
  - タップ操作時は読み上げしない
- [ ] 試合終了時のホイッスル音（5秒間）
- [ ] 読み上げのオン/オフ切り替え

#### UI/UX

- [ ] 横画面（ランドスケープ）専用
- [ ] 画面スリープ防止（アプリ起動中は常時点灯）
- [ ] 大きく見やすい得点表示
- [ ] タップ操作による得点変更
- [ ] ダークモード対応

### 将来リリース（v2.0以降）

**優先度：高**
- [ ] 管理者声紋認証 + オーバーコール機能
  - 管理者の声を事前登録
  - 「スコア」→「オーバーコール」→「右10 左12」で任意得点に強制設定
  - 管理者以外の声ではオーバーコール無効（いたずら防止）

**優先度：通常**
- [ ] ウェイクワードのカスタマイズ
- [ ] セットカウント管理
- [ ] タイムアウト回数管理
- [ ] サーブ権表示
- [ ] 試合履歴の保存
- [ ] チーム名のカスタマイズ
- [ ] 複数競技対応

---

## 非機能要件

### パフォーマンス

- アプリ起動: 3秒以内
- 音声認識レスポンス: 1秒以内
- オフライン動作対応

### セキュリティ

- マイク権限の適切な管理
- ローカルデータのみ（サーバー通信なし）

### 対応プラットフォーム

- iOS 14.0以上
- Android 10以上

---

## 技術スタック

### フレームワーク

- **React Native** + **Expo**
  - クロスプラットフォーム開発
  - 豊富なライブラリエコシステム

#### Expoワークフロー

**Development Build（Managed Workflow + EAS Build）**を採用する。

| 項目 | 内容 |
|------|------|
| 方式 | Development Build |
| ビルド | EAS Build（Expoのクラウドビルドサービス） |
| 理由 | 音声認識（@react-native-voice/voice）にネイティブモジュールが必要 |

※ 開発中に以下の学習ドキュメントを `docs/learning/` に随時生成する
  - React Native基礎
  - Expo / Development Build
  - EAS Build / EAS Submit

### 主要ライブラリ

| 機能 | ライブラリ |
|------|-----------|
| 音声認識 | `@react-native-voice/voice` |
| 音声読み上げ | `expo-speech` |
| 効果音再生 | `expo-av` |
| 永続化 | `@react-native-async-storage/async-storage` |
| スリープ防止 | `expo-keep-awake` |
| 状態管理 | `zustand` |
| スタイリング | `nativewind` (Tailwind CSS) |

### 開発環境

| 項目 | 内容 |
|------|------|
| OS | Windows 11 |
| コンテナ | Docker Desktop + DevContainer |
| エディタ | VS Code（Dev Containers拡張機能） |

**DevContainer構成:**

```
.devcontainer/
├── devcontainer.json    # DevContainer設定
└── Dockerfile           # 開発環境イメージ（必要に応じて）
```

**開発フロー:**

```
Windows 11
    │
    ▼
┌─────────────────────────────────┐
│       DevContainer              │
│  ┌───────────────────────────┐  │
│  │  Node.js + Expo CLI       │  │
│  │  開発サーバー起動          │  │
│  └───────────────────────────┘  │
└─────────────────────────────────┘
    │
    ▼ (Expo Go / Development Build)
┌─────────────────────────────────┐
│    実機（iOS / Android）        │
└─────────────────────────────────┘
```

※ iOSビルドはEAS Build（クラウド）を使用（Macが不要）
※ 実機テストはExpo GoまたはDevelopment Buildを使用

**動作確認環境（後日構築）:**

| 方法 | 対象OS | 備考 |
|------|--------|------|
| Androidエミュレータ | Android | Windows側にAndroid Studioを導入 |
| 実機（Android） | Android | Expo Go または Development Build |
| 実機（iOS） | iOS | Expo Go または Development Build |
| iOSシミュレータ | iOS | Mac不要、EAS Buildで対応 |

※ 開発環境構築の詳細手順は `docs/learning/` に別途ドキュメント化する

**アプリ配布方法:**

| 方法 | 用途 | ストア経由 | ネイティブモジュール |
|------|------|-----------|-------------------|
| Expo Go | 開発プレビュー | 不要 | × 使えない |
| Development Build | 開発・テスト | 不要 | ◎ 使える |
| Preview Build (APK) | 実地検証 | 不要 | ◎ 使える |
| Production Build | ストア公開 | 必要 | ◎ 使える |

※ 音声認識（@react-native-voice/voice）を使用するため、Expo Goは使用不可

**実地検証フロー（ストア公開前）:**

```
開発（DevContainer）
    ↓
EAS Build（Preview Build）
    ↓ APKファイル生成・ダウンロード
Android実機に直接インストール（サイドローディング）
    ↓
実地検証（バレーボール練習時）
    ↓
問題なければ Production Build → ストア公開
```

```bash
# Preview Buildの実行例
eas build --platform android --profile preview
```

### 開発ツール

- TypeScript
- ESLint / Prettier
- Jest（テスト）

### 開発ワークフロー

本プロジェクトは**仕様駆動開発（SDD: Spec-Driven Development）**で進行する。

| 項目 | ツール | 用途 |
|------|--------|------|
| 画面レイアウト | Figma Make | AIによるUI設計・プロトタイプ作成 |
| SDD | cc-sdd | 仕様→設計→タスク→実装のワークフロー管理 |

#### cc-sdd ワークフロー

```bash
# インストール（日本語）
npx cc-sdd@latest --lang ja
```

1. `/kiro:spec-init` - 新機能の仕様作成開始
2. `/kiro:spec-requirements` - 詳細要件の生成
3. `/kiro:spec-design` - 技術設計の作成
4. `/kiro:spec-tasks` - タスク分解
5. `/kiro:spec-impl` - TDDで実装

各フェーズで人間の承認を経てから次へ進む。

#### テスト戦略（TDD）

本プロジェクトは**テスト駆動開発（TDD）**で進行する。

```
Red → Green → Refactor のサイクル

1. Red:    失敗するテストを書く
2. Green:  テストを通す最小限のコードを書く
3. Refactor: コードを整理する（テストは緑のまま）
```

**ツール構成:**

| Phase | ツール | 用途 |
|-------|--------|------|
| Phase 1 | cc-sdd (`/kiro:spec-impl`) | SDD統合のTDDワークフロー |
| Phase 2 | TDD Guard（必要に応じて追加） | TDD違反のブロック・強制 |

**テストフレームワーク:**

| 種別 | フレームワーク |
|------|---------------|
| 単体テスト | Jest |
| コンポーネントテスト | React Native Testing Library |
| E2Eテスト | Maestro（将来対応） |

#### 状態管理設計

**ランタイム状態**: zustand（シンプル・軽量）
**永続化**: AsyncStorage（設定のみ）

```
┌─────────────────────────────────────────────┐
│              zustand store                  │
├─────────────┬─────────────┬─────────────────┤
│   スコア    │  操作履歴   │      設定       │
│  (メモリ)   │  (メモリ)   │   (永続化)      │
├─────────────┴─────────────┴────────┬────────┤
│                                    ↓        │
│                              AsyncStorage   │
└─────────────────────────────────────────────┘
```

| データ | 永続化 | 内容 |
|--------|--------|------|
| スコア | × | 左右の得点（試合終了でリセット） |
| 操作履歴 | × | ロールバック用の操作スタック |
| 設定 | ◎ | 読み上げOn/Off、音声認識On/Off等 |

#### アーキテクチャ

**Feature-based + Clean Architecture 軽量版**を採用する。

- 機能ごとにディレクトリを分割（Feature-based）
- 各feature内で責務分離（Clean Architectureの考え方）
- 将来の競技追加に対応しやすい構造

#### ディレクトリ構成

```
src/
├── features/                # 機能ごとのモジュール
│   ├── score/               # 得点管理
│   │   ├── components/      # UI（Presentation）
│   │   ├── hooks/           # ロジック（UseCase相当）
│   │   ├── types/           # 型定義（Entity相当）
│   │   └── index.ts
│   ├── voice/               # 音声入出力
│   │   ├── components/
│   │   ├── hooks/
│   │   ├── services/        # 音声認識・読み上げサービス
│   │   └── types/
│   └── settings/            # 設定
│       ├── components/
│       ├── hooks/
│       └── types/
├── components/              # 共通UIコンポーネント
│   ├── Button/
│   ├── ScoreDisplay/
│   └── ...
├── stores/                  # zustand ストア
├── utils/                   # 共通ユーティリティ
├── types/                   # 共通型定義
├── constants/               # 定数
└── assets/                  # 画像・音声ファイル
    └── sounds/              # ホイッスル音等

docs/
└── learning/                # 学習ドキュメント（開発中に生成）

tests/                       # テストファイル
├── unit/
└── integration/
```

#### 音声認識の実装方針

**常時リスニング方式**を採用する。
※ 使用時はモバイルバッテリー等に接続を想定、バッテリー消費は考慮しない

**状態マシン（K.I.T.T.スタイル）:**

```
        ┌─────────────────────────────────────────────────────────┐
        │                                                         │
        ▼                                                         │
   ┌─────────┐  「スコア」検出   ┌─────────┐        ┌──────────────┐
   │  IDLE   │ ───────────────→│ 「Ready」│──────→│  LISTENING   │
   │ (待機)  │                  │  応答   │        │ (認識モード)  │
   └─────────┘ ←────────────────┴─────────┴─────── └──────────────┘
                 「Roger」応答 + コマンド実行 or 3秒タイムアウト
```

| 状態 | 説明 | 認識対象 |
|------|------|----------|
| IDLE | 待機中 | 「スコア」のみ |
| LISTENING | 認識モード（3秒間） | 「右」「左」「ロールバック」「リセット」 |

**処理フロー:**

1. アプリ起動時に音声認識を開始（常時リスニング）
2. IDLE状態で「スコア」を検出 → 「Ready」と応答 → LISTENING状態へ遷移
3. LISTENING状態で3秒以内にコマンドを検出 → 「Roger」と応答 → 対応する操作を実行
4. ロールバック/リセットの場合はスコア読み上げ
5. コマンド実行後 or 3秒タイムアウト → IDLE状態に戻る

#### コードレビュー

**CodeRabbit**によるAI自動レビューを導入する。

| 項目 | 内容 |
|------|------|
| ツール | [CodeRabbit](https://www.coderabbit.ai/) |
| 料金 | 無料（Publicリポジトリ） |
| 設定 | `.coderabbit.yaml` |

**レビューフロー:**

```
プルリクエスト作成
        ↓
┌───────────────────┬──────────────────┐
│    CodeRabbit     │      CI/CD       │
│    AIレビュー     │   テスト・ビルド  │
└───────────────────┴──────────────────┘
        ↓
    マージ判断
```

**期待効果:**
- 一人開発でも第三者視点のレビューが得られる
- React Native未経験分野でのベストプラクティス習得
- コード品質の向上

#### CI/CD

**GitHub Actions + EAS Build** を採用する。

| サービス | 用途 | 料金（Public） |
|---------|------|---------------|
| GitHub Actions | CI（テスト・リント・型チェック） | 無料 |
| EAS Build | アプリビルド | 無料枠（30ビルド/月） |
| EAS Submit | ストア申請 | 無料 |

**CI パイプライン（GitHub Actions）:**

```yaml
# プルリクエスト / Push時に実行
jobs:
  - lint        # ESLint + Prettier
  - typecheck   # TypeScript型検査
  - test        # Jest単体テスト
  - build-check # Expoビルド検証
```

**CD パイプライン（EAS Build）:**

| ビルド種別 | タイミング | 用途 |
|-----------|-----------|------|
| Development | 必要時 | 開発用（実機テスト） |
| Preview | mainマージ時 | テスト配布 |
| Production | リリース時 | ストア申請 |

※ 開発中にEAS Buildの学習ドキュメントを `docs/learning/` に生成する

### コーディング規約

本プロジェクトは**モバイルアプリ開発の学習**を兼ねているため、以下の方針でコードを記述する。

#### コメント方針

すべてのコードに詳細なコメントを付与し、以下を説明する：

1. **目的**: このコードは何を実現するためのものか
2. **根拠**: なぜこの実装方法を選んだか（他の選択肢との比較含む）

```typescript
// 【目的】音声認識の結果を受け取り、コマンドとして解釈する
// 【根拠】音声認識は非同期で結果が返ってくるため、コールバック形式で処理する。
//        Promiseではなくコールバックを使う理由は、認識中に部分的な結果も
//        受け取れるようにするため（リアルタイム性の確保）
const handleSpeechResult = (result: string) => {
  // ...
};
```

#### その他の規約

- 関数・コンポーネントの冒頭にJSDocで概要を記述
- 複雑なロジックには処理の流れをステップごとにコメント
- React Native / Expo特有の概念は補足説明を追加
- 「なぜそうしないか」も必要に応じて記載

---

## 画面構成

※ 横画面（ランドスケープ）専用

```
┌─────────────────────────────────┐
│         Voice Scoreboard        │
├───────────────┬─────────────────┤
│               │                 │
│     左        │       右        │
│               │                 │
│     15        │       12        │
│               │                 │
│   [ +1 ]      │     [ +1 ]      │
│   [ -1 ]      │     [ -1 ]      │
│               │                 │
├───────────────┴─────────────────┤
│  🎤 音声入力   🔊 読み上げ       │
│  [ ロールバック ] [ リセット ]   │
└─────────────────────────────────┘
```

### 音声コマンド一覧（K.I.T.T.スタイル）

双方向の音声インターフェースで操作します。

```
ユーザー: 「スコア」
システム: 「Ready」 ← 認識モード開始（3秒間）
ユーザー: 「右」
システム: 「Roger」 ← コマンド実行
```

| ユーザー発声 | システム応答 | 動作 |
|-------------|-------------|------|
| 「スコア」→「右」 | Ready → Roger | 右側チームに+1点 |
| 「スコア」→「左」 | Ready → Roger | 左側チームに+1点 |
| 「スコア」→「ロールバック」 | Ready → Roger → スコア読み上げ | 直前の1操作を取り消し |
| 「スコア」→「リセット」 | Ready → Roger → スコア読み上げ | 0-0に戻す |

※ ウェイクワードのカスタマイズはv2.0以降で検討

---

## 開発ロードマップ

### Phase 1: 基盤構築

1. プロジェクトセットアップ（Expo + TypeScript）
2. 基本UI実装（得点表示、ボタン操作）
3. 状態管理の実装

### Phase 2: 音声機能

4. 音声読み上げ機能の実装
5. 音声認識機能の実装
6. 音声コマンドの定義と処理

### Phase 3: 仕上げ

7. UI/UXの改善
8. テスト実装
9. ストア公開準備

---

## セットアップ

```bash
# 依存関係のインストール
npm install

# 開発サーバー起動
npm start

# iOSシミュレーター
npm run ios

# Androidエミュレーター
npm run android
```

---

## ライセンス

MIT License

---

## 作者

<!-- 作者情報をここに記載 -->
