# Task 3.0 (M1): Android Development Build 環境構築と起動確認

## Plan（実装前の方針）
- expo-dev-client をインストールし、expo prebuild で android/ を生成
- ANDROID_HOME 環境変数を設定し、WSL2 から Android SDK にアクセス可能にする
- Pixel_7a エミュレータでアプリをビルド・起動し、横画面とダークネイビー背景を検証

## 実施内容
- tasks.md に Task 3.0 を追加
- `~/.bashrc` に ANDROID_HOME 環境変数を設定（Windows SDK パス）
- `expo-dev-client@5.0.20` をインストール
- `app.json` の plugins に `expo-dev-client` を追加
- `expo prebuild --platform android` で android/ ディレクトリを生成
- NDK 26.1.10909125 を sdkmanager 経由でインストール（WSL2 上の Java から直接実行）
- adb.exe の WSL2 ラッパースクリプトとシンボリックリンクを作成
- debug ビルド（`expo run:android`）: BUILD SUCCESSFUL（22分55秒）
- release ビルド（`expo run:android --variant release`）: BUILD SUCCESSFUL（26分22秒）
- release APK を手動で adb install（Windows パス指定）
- エミュレータ上でアプリ起動を確認

## 実装結果

### 変更ファイル
| ファイル | 変更内容 |
|---------|----------|
| `~/.bashrc` | ANDROID_HOME 環境変数の追加 |
| `package.json` | expo-dev-client 依存追加 |
| `app.json` | plugins に expo-dev-client 追加 |
| `.kiro/specs/voice-scoreboard/tasks.md` | Task 3.0 追加 + 完了チェック |

### 生成ファイル（git 管理外）
| ファイル | 役割 |
|---------|------|
| `android/` | expo prebuild で生成されたネイティブプロジェクト |
| `~/.local/bin/adb` | WSL2 用 adb ラッパースクリプト |

## 検証結果

| 項目 | 結果 |
|------|------|
| `expo prebuild --platform android` エラーなし | OK |
| `android/` ディレクトリ生成 | OK |
| debug ビルド成功 | OK（22m 55s） |
| release ビルド成功 | OK（26m 22s） |
| エミュレータ上でアプリ起動 | OK |
| 横画面（ランドスケープ）表示 | OK |
| ダークネイビー背景（#0f172a） | OK |
| NativeWind スタイリング適用 | OK（グロー効果 + シアン色テキスト） |

## 学んだこと

### WSL2 + Android 開発の注意点

1. **adb.exe と WSL パス**: Expo は `$ANDROID_HOME/platform-tools/adb` をフルパスで参照する。WSL2 では `adb.exe` しか存在しないため、シンボリックリンク（`adb -> adb.exe`）の作成が必要

2. **NDK インストール**: Gradle 経由の NDK インストールは WSL2 上で zip 展開に失敗する。代わりに sdkmanager の jar を WSL2 の Java で直接実行すると成功:
   ```bash
   java -Dcom.android.sdklib.toolsdir="$ANDROID_HOME/cmdline-tools/latest" \
     -classpath "$ANDROID_HOME/cmdline-tools/latest/lib/sdkmanager-classpath.jar" \
     com.android.sdklib.tool.sdkmanager.SdkManagerCli --install "ndk;26.1.10909125"
   ```

3. **APK インストール**: `expo run:android` の自動インストールは WSL パスを adb.exe に渡すため失敗する。Windows パスで手動インストールが必要:
   ```bash
   adb.exe install -r -d "C:\\Develop\\voice-scoreboard\\android\\app\\build\\outputs\\apk\\release\\app-release.apk"
   ```

4. **Metro 接続**: WSL2 上の Metro bundler とエミュレータ間のネットワーク接続はタイムアウトする。release ビルド（JS バンドル埋め込み）で回避可能。開発時の hot reload には別途対策が必要

5. **ビルド時間**: `/mnt/c/` 上での Gradle ビルドは 9P ファイルシステムブリッジの影響で20分以上かかる。2回目以降はキャッシュにより短縮される見込み
