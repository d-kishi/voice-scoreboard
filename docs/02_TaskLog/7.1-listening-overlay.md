# Task 7.1: LISTENING状態のオーバーレイ表示

## 実装予測（Plan モードでの分析）
- LISTENING 状態時に画面中央にシアン同心円発光リング + マイクアイコン + 「Ready」テキスト + カウントダウンを表示
- ディム効果は `bg-black/60`（expo-blur 未インストール、ResetDialog/GameEndOverlay と一貫）
- 同心円リングは 3 層ネスト View の border + opacity 段階変化で表現
- props ベースのプレゼンテーションコンポーネント（`visible`, `countdown`）
- 新規パッケージ不要

## 実施内容
- tasks.md の Task 7.1: LISTENING状態のオーバーレイ表示
  - Requirements: 4.3（LISTENING 状態の UI 表示）, 4.4（3 秒カウントダウン表示）
  - Contracts: ListeningOverlay

## 実装結果

### 作成/変更ファイル
| ファイル | 操作 | 役割 |
|---------|------|------|
| `src/features/voice/components/ListeningOverlay.tsx` | 新規 | LISTENING 状態のオーバーレイ UI。同心円シアンリング + マイクアイコン + Ready テキスト + カウントダウン |
| `src/features/voice/components/__tests__/listening-overlay.test.tsx` | 新規 | ListeningOverlay のユニットテスト（9 テスト） |
| `.kiro/specs/voice-scoreboard/tasks.md` | 変更 | Task 7.1 を `[x]` に更新 |

### テスト結果
- スイート名: listening-overlay.test.tsx — 9/9 PASS
- 全体: 18 スイート、296 テスト PASS（リグレッションなし）

### テストケース一覧

#### visible=true の場合（6 テスト）
| ケース | 期待値 |
|--------|--------|
| オーバーレイが表示される | `listening-overlay` testID が存在 |
| マイクアイコンが表示される | `listening-mic-icon` testID が存在 |
| 「Ready」テキストが表示される | テキスト "Ready" が存在 |
| カウントダウン秒数が表示される | テキスト "3s" が存在 |
| ディム背景が表示される | `listening-dim-bg` testID が存在 |
| 同心円リングが表示される | `listening-ring-outer/middle/inner` の 3 testID が存在 |

#### カウントダウン表示（2 テスト）
| ケース | 期待値 |
|--------|--------|
| countdown=2 | テキスト "2s" が存在 |
| countdown=1 | テキスト "1s" が存在 |

#### visible=false の場合（1 テスト）
| ケース | 期待値 |
|--------|--------|
| 何も表示されない | `listening-overlay` testID が null |

## 予測との比較
| 項目 | 予測 | 実際 | 乖離 |
|------|------|------|------|
| ブラー効果 | ディムのみ（`bg-black/60`） | ディムのみ（`bg-black/60`） | なし |
| 同心円リング | 3 層ネスト View + opacity 段階変化 | 3 層ネスト View（0.15→0.4→0.8） | なし |
| コンポーネント設計 | props ベース（visible, countdown） | props ベース（visible, countdown） | なし |
| マイクアイコン testID | View ラッパー方式 | View ラッパー方式 | なし |
| 追加パッケージ | なし | なし | なし |
| 変更ファイル数 | 2 ファイル新規 | 2 ファイル新規 + tasks.md 変更 | なし |
| __mocks__ 変更 | 不要（Feather モック済み） | 不要 | なし |

## 意思決定ログ
| 選択肢 | 採用 | 理由 |
|--------|------|------|
| expo-blur vs ディム効果のみ | ディム効果のみ | expo-blur 未インストール。追加すると prebuild + 再ビルド必要。ResetDialog/GameEndOverlay と一貫 |
| react-native-svg vs ネスト View | ネスト View | 追加パッケージ不要。border + opacity の段階変化で発光リングを十分に表現可能 |
| Modal vs absolute positioning | absolute positioning | 下部バー（ControlBar）をディム対象外にするため。GameEndOverlay と同じアプローチ |
| アイコンの testID 付与方法 | View ラッパー | `__mocks__/@expo/vector-icons.js` のモックが testID を透過しないため |
| visible=false の実装 | null 返却 | GameEndOverlay と同様に、親コンポーネント側で条件レンダリングする可能性もあるが、コンポーネント内部で null 返却する方がシンプルで安全 |

## 学び（Lessons Learned）
- 同心円発光リングは react-native-svg なしで、ネスト View の `borderColor` + `backgroundColor` の opacity 段階変化で十分に表現できる。シンプルなアプローチが最も効果的
- GameEndOverlay で確立された「absoluteFill + ディム + 中央配置」パターンは、LISTENING オーバーレイでもそのまま再利用でき、プロジェクト全体の UI 一貫性を保てた
- `__mocks__/@expo/vector-icons.js` の Feather モックは `props.name` のみを Text として返すため、testID をアイコンに直接付与できない。View ラッパーパターンが定石
