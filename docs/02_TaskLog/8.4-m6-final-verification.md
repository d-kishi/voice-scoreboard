# Task 8.4 (M6): Android 実機による最終検証

## 実施内容
- tasks.md の Task 8.4 (M6): Android 実機による最終検証
  - 音声認識の日本語（ja-JP）認識精度とレスポンスを実機で確認
  - 音声コマンド E2E フロー（「スコア」→「Ready」→コマンド→スコア反映）の実機動作確認
  - エミュレータで検証できなかった項目（M4/M5 で委ねた項目）の実機フォローアップ
  - オフライン環境（機内モード）での音声認識オンデバイスモデル動作確認
  - 起動パフォーマンス（3秒以内）の実測
  - _Milestone: M6（実機最終検証 — Release Ready）_

## 検証環境

| 項目 | 値 |
|------|-----|
| デバイス | Pixel 7a |
| デバイスID | 32271JEHN19359 |
| ビルド | release (arm64-v8a) |
| 検証日 | 2026-02-28 |

## 検証結果

| # | 検証項目 | 結果 | 備考 |
|---|---------|:----:|------|
| 1 | 起動パフォーマンス（3秒以内） | OK | — |
| 2 | 音声 E2E フロー | OK | web_search モデル適用後、遠距離での認識精度が劇的に改善 |
| 3 | オフライン動作（機内モード） | OK | — |
| 4 | 設定トグル（音声入力/読み上げ ON/OFF） | OK | — |
| 5 | 試合終了 + ホイッスル音 | OK | — |

全検証項目 PASS。

## 検証中に発見・対応した改善

### 音声認識の遠距離検知改善

**問題**: ウェイクワード「スコア」の検知が、デバイスから少し距離を離すと認識しなくなる。

**原因調査**: expo-speech-recognition のデフォルト言語モデルが `free_form`（自由発話向け）で、短い単語の認識に最適化されていなかった。

**対応**: `buildStartOptions()` で全モード共通に `EXTRA_LANGUAGE_MODEL: 'web_search'` を設定。Google 開発チームが単一ワード認識に web_search モデルを推奨している。

**結果**: wakeword・command 両モードで遠距離認識精度が劇的に改善。

### LISTENING タイムアウト延長

`LISTENING_DURATION` を 5秒 → 10秒 に変更。コマンド入力の猶予を拡大。

## 作成/変更ファイル

| ファイル | 操作 | 役割 |
|---------|------|------|
| `docs/02_TaskLog/8.4-m6-final-verification.md` | 作成 | 本タスクログ |

※ 音声認識改善・タイムアウト変更のコード修正は別エージェントの作業と合わせて後日コミット予定。

## 意思決定ログ

| 選択肢 | 採用 | 理由 |
|--------|------|------|
| `EXTRA_LANGUAGE_MODEL: 'web_search'` を wakeword のみに適用 | 不採用 | command モードの「右」「左」等も短い単語のため、全モード共通で適用した方が効果的 |
| `EXTRA_LANGUAGE_MODEL: 'web_search'` を全モード共通に適用 | 採用 | wakeword・command 両方で遠距離認識の劇的改善を実機確認 |
| LISTENING タイムアウト 5秒のまま | 不採用 | 実使用で発話猶予が短いと感じられた |
| LISTENING タイムアウト 10秒に延長 | 採用 | コマンド入力の余裕を確保 |

## 学び（Lessons Learned）

- Android SpeechRecognizer の `EXTRA_LANGUAGE_MODEL` は認識精度に大きな影響を与える。短い単語・コマンドの認識には `web_search` モデルが `free_form` より遥かに効果的
- ハードウェア（外部マイク）導入を検討する前に、ソフトウェア設定の最適化を先に試すべき。コスト0で劇的改善が得られることがある
- 実機検証でしか発見できない問題（遠距離認識精度）がある。エミュレータ検証と実機検証は相互補完的
