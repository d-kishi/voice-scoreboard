# Task 4.2: 画面スリープ防止の組み込み

## 実装予測（Plan モードでの分析）
- `useKeepAwake()` は既に App.tsx L21 に実装済み。残りはテスト作成のみ
- 変更対象: `__mocks__/expo-keep-awake.js`（新規）、`App.test.tsx`（編集）
- モック方式は `__mocks__/` ディレクトリ方式（既存パターンに準拠）

## 実施内容
- Task 4.2: expo-keep-awake のテストカバレッジ追加
  - Requirement 7.1: アプリがフォアグラウンドで起動中、画面スリープを防止し常時点灯状態を維持する

## 実装結果（spec-impl の実際の出力）

### 作成/変更ファイル
| ファイル | 操作 | 内容 |
|---------|------|------|
| `__mocks__/expo-keep-awake.js` | 新規作成 | useKeepAwake の jest.fn() モック |
| `App.test.tsx` | 編集 | 「画面スリープ防止」describe ブロック追加（useKeepAwake 呼び出し検証） |
| `.kiro/specs/voice-scoreboard/tasks.md` | 編集 | Task 4.2 チェックボックスを `[x]` に更新 |

### テスト結果
- App.test.tsx: 7/7 PASS（新規 1 テスト + 既存 6 テスト）
- 全テストスイート: 132/132 PASS（リグレッションなし）

## 予測との乖離
- **乖離なし**: 予測通り、モックファイル作成 + テスト追加のみで完了
- 実装コード（App.tsx）への変更は不要だった（Task 3.0 時点で組み込み済み）

## 意思決定ログ
| 選択肢 | 採用 | 理由 |
|--------|------|------|
| `__mocks__/` ディレクトリ方式 vs `jest.setup.ts` 内 mock | `__mocks__/` | 既存パターン（@expo/vector-icons）に準拠。jest.setup.ts は JSX 制約あり |
| 再レンダリング時の呼び出し回数テスト追加 | 不採用 | React hooks は再レンダリング毎に呼ばれるのは自明。過剰テストを避けた |

## 学び（Lessons Learned）
- Task 3.0（M1 ビルド環境構築）で useKeepAwake を先行実装していたため、4.2 はテストのみの軽量タスクになった
- Task 4.1 と 4.2 の並行実装は問題なく成功。ファイル競合ゼロで独立して作業できた
- サンドボックス環境では Jest の `--watchman=false` + `--cacheDirectory` 指定が必要
